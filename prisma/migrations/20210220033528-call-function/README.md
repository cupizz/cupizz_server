# Migration `20210220033528-call-function`

This migration has been generated by Hien at 2/20/2021, 3:35:28 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Message" ADD COLUMN "isCallMessage" boolean   NOT NULL DEFAULT false,
ADD COLUMN "startedCallAt" timestamp(3)   ,
ADD COLUMN "endedCallAt" timestamp(3)   ,
ADD COLUMN "endedById" text   

ALTER TABLE "public"."User" ADD COLUMN "isInACall" boolean   NOT NULL DEFAULT false

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("endedById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210211084351-add-is-finding-anonymous-chat..20210220033528-call-function
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider        = "prisma-client-js"
@@ -191,8 +191,11 @@
   remainingSuperLike          Int                    @default(5)
   remainingSuperLikeUpdatedAt DateTime               @default(now())
   UserLikedPost               UserLikedPost[]
   isFindingAnonymousChat      Boolean                @default(false)
+  // Dùng để chặn không cho người khác gọi khi đang ở trong 1 cuộc gọi
+  isInACall                   Boolean                @default(false)
+  endedCallMessages           Message[]
 }
 model UserDeviceToken {
   token    String   @id
@@ -330,8 +333,14 @@
   deletedAt               DateTime?
   lastReadMessageOfMember ConversationMember[]
   MessageAttachment       MessageAttachment[]
   isAnonymousChat         Boolean              @default(false)
+  // For call message
+  isCallMessage           Boolean              @default(false)
+  startedCallAt           DateTime?
+  endedCallAt             DateTime?
+  endedBy                 User?                @relation(fields: [endedById], references: [id])
+  endedById               String?
 }
 model MessageAttachment {
   message   Message @relation(fields: [messageId], references: [id])
```


