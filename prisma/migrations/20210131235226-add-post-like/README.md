# Migration `20210131235226-add-post-like`

This migration has been generated by Hien at 1/31/2021, 11:52:26 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."LikeType" AS ENUM ('like', 'love', 'wow', 'haha', 'angry', 'sad')

CREATE TABLE "public"."UserLikedPost" (
"userId" text   NOT NULL ,
"postId" integer   NOT NULL ,
"type" "LikeType"  NOT NULL DEFAULT E'like',
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","postId")
)

ALTER TABLE "public"."UserLikedPost" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserLikedPost" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210126153658-add-limit-super-like..20210131235226-add-post-like
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider        = "prisma-client-js"
@@ -111,8 +111,17 @@
   spiritual
   other
 }
+enum LikeType {
+  like
+  love
+  wow
+  haha
+  angry
+  sad
+}
+
 model User {
   id                          String                 @id @default(uuid())
   password                    String?
   nickName                    String
@@ -179,8 +188,9 @@
   Comment                     Comment[]
   Post                        Post[]
   remainingSuperLike          Int                    @default(5)
   remainingSuperLikeUpdatedAt DateTime               @default(now())
+  UserLikedPost               UserLikedPost[]
 }
 model UserDeviceToken {
   token    String   @id
@@ -332,20 +342,32 @@
   Post  Post[]
 }
 model Post {
-  id          Int          @id @default(autoincrement())
-  content     String
-  category    PostCategory @relation(fields: [categoryId], references: [id])
-  categoryId  String
-  comment     Comment[]
-  createdAt   DateTime     @default(now())
-  updatedAt   DateTime     @updatedAt
-  deletedAt   DateTime?
-  createdBy   User         @relation(fields: [createdById], references: [id])
-  createdById String
+  id            Int             @id @default(autoincrement())
+  content       String
+  category      PostCategory    @relation(fields: [categoryId], references: [id])
+  categoryId    String
+  comment       Comment[]
+  createdAt     DateTime        @default(now())
+  updatedAt     DateTime        @updatedAt
+  deletedAt     DateTime?
+  createdBy     User            @relation(fields: [createdById], references: [id])
+  createdById   String
+  UserLikedPost UserLikedPost[]
 }
+model UserLikedPost {
+  user      User     @relation(fields: [userId], references: [id])
+  post      Post     @relation(fields: [postId], references: [id])
+  userId    String
+  postId    Int
+  type      LikeType @default(like)
+  createdAt DateTime @default(now())
+
+  @@id([userId, postId])
+}
+
 model Comment {
   id            String    @id @default(cuid())
   index         Int
   parentComment Comment?  @relation("ReplyToComment", fields: [parentId], references: [id])
```


