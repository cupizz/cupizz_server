# Migration `20200914094857-init`

This migration has been generated by Hiển at 9/14/2020, 9:48:57 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"id" SERIAL,
"password" text   NOT NULL ,
"nickName" text   NOT NULL ,
"birthday" timestamp(3)   NOT NULL ,
"genderBorn" "GenderBorn"  NOT NULL ,
"gender" "Gender"  NOT NULL ,
"bodies" text []  ,
"personalities" text []  ,
"hobbies" text []  ,
"introduction" text   NOT NULL ,
"agesOtherPerson" text []  ,
"genderBornOtherPerson" "GenderBorn"[]  ,
"genderOtherPerson" "Gender"[]  ,
"bodiesOtherPerson" text []  ,
"personalitiesOtherPerson" text []  ,
"allowMatching" boolean   NOT NULL DEFAULT true,
"isPrivate" boolean   NOT NULL DEFAULT false,
"showActive" boolean   NOT NULL DEFAULT true,
"phoneNumber" text   ,
"job" text   ,
"isPrivateJob" boolean   NOT NULL DEFAULT false,
"degree" text   ,
"isPrivateDegree" boolean   NOT NULL DEFAULT false,
"schedule" jsonb   ,
"hasFreeTime" boolean   NOT NULL DEFAULT true,
"updatedAt" timestamp(3)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"deletedAt" timestamp(3)   ,
"areaId" integer   NOT NULL ,
"cityId" integer   NOT NULL ,
"identifyImageId" integer   NOT NULL ,
"avatarId" integer   ,
"roleId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SocialProvider" (
"id" text   NOT NULL ,
"type" "SocialProviderType"  NOT NULL ,
"userId" integer   NOT NULL ,
"email" text   ,
"phoneNumber" text   ,
"name" text   ,
"avatar" text   ,
"gender" "Gender"  ,
"birthday" timestamp(3)   ,
PRIMARY KEY ("id","type")
)

CREATE TABLE "public"."Friend" (
"senderId" integer   NOT NULL ,
"receiverId" integer   NOT NULL ,
"sentAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"acceptedAt" timestamp(3)   ,
PRIMARY KEY ("senderId","receiverId")
)

CREATE TABLE "public"."UserImage" (
"userId" integer   NOT NULL ,
"imageId" integer   NOT NULL ,
PRIMARY KEY ("userId","imageId")
)

CREATE TABLE "public"."UserAreaOtherPerson" (
"userId" integer   NOT NULL ,
"areaId" integer   NOT NULL ,
PRIMARY KEY ("userId","areaId")
)

CREATE TABLE "public"."UserCityOtherPerson" (
"userId" integer   NOT NULL ,
"cityId" integer   NOT NULL ,
PRIMARY KEY ("userId","cityId")
)

CREATE TABLE "public"."UserPurposeUseApp" (
"userId" integer   NOT NULL ,
"purposeId" integer   NOT NULL ,
PRIMARY KEY ("userId","purposeId")
)

CREATE TABLE "public"."Area" (
"id" SERIAL,
"area" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."City" (
"id" SERIAL,
"city" text   NOT NULL ,
"areaId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PurposeUseApp" (
"id" SERIAL,
"value" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."File" (
"id" SERIAL,
"type" "FileType"  NOT NULL ,
"url" text   NOT NULL ,
"thumbnail" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Role" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"description" text   ,
"permissions" text []  ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Message" (
"id" SERIAL,
"message" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"senderId" integer   NOT NULL ,
"receiverId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."MessageAttachment" (
"messageId" integer   NOT NULL ,
"fileId" integer   NOT NULL ,
PRIMARY KEY ("messageId","fileId")
)

CREATE TABLE "public"."PostCategory" (
"id" SERIAL,
"value" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Post" (
"id" SERIAL,
"categoryId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Comment" (
"id" SERIAL,
"index" integer   NOT NULL ,
"parentId" integer   ,
"content" text   NOT NULL ,
"postId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."QnA" (
"id" SERIAL,
"question" text   NOT NULL ,
"answer" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "SocialProvider.userId_unique" ON "public"."SocialProvider"("userId")

CREATE UNIQUE INDEX "Role.id_unique" ON "public"."Role"("id")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("areaId")REFERENCES "public"."Area"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("cityId")REFERENCES "public"."City"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("identifyImageId")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("avatarId")REFERENCES "public"."File"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("roleId")REFERENCES "public"."Role"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SocialProvider" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Friend" ADD FOREIGN KEY ("senderId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Friend" ADD FOREIGN KEY ("receiverId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserImage" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserImage" ADD FOREIGN KEY ("imageId")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserAreaOtherPerson" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserAreaOtherPerson" ADD FOREIGN KEY ("areaId")REFERENCES "public"."Area"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserCityOtherPerson" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserCityOtherPerson" ADD FOREIGN KEY ("cityId")REFERENCES "public"."City"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserPurposeUseApp" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserPurposeUseApp" ADD FOREIGN KEY ("purposeId")REFERENCES "public"."PurposeUseApp"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."City" ADD FOREIGN KEY ("areaId")REFERENCES "public"."Area"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("senderId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Message" ADD FOREIGN KEY ("receiverId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."MessageAttachment" ADD FOREIGN KEY ("messageId")REFERENCES "public"."Message"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."MessageAttachment" ADD FOREIGN KEY ("fileId")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."PostCategory"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("parentId")REFERENCES "public"."Comment"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200914094857-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,233 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum GenderBorn {
+  male
+  female
+}
+
+enum Gender {
+  male
+  female
+  other
+}
+
+enum FileType {
+  image
+  sound
+}
+
+enum SocialProviderType {
+  email
+  facebook
+  google
+  apple
+}
+
+model User {
+  id                       Int                   @default(autoincrement()) @id
+  password                 String
+  nickName                 String
+  birthday                 DateTime
+  genderBorn               GenderBorn
+  gender                   Gender
+  bodies                   String[]
+  personalities            String[]
+  hobbies                  String[]
+  introduction             String
+  agesOtherPerson          String[]
+  genderBornOtherPerson    GenderBorn[]
+  genderOtherPerson        Gender[]
+  bodiesOtherPerson        String[]
+  personalitiesOtherPerson String[]
+  allowMatching            Boolean               @default(true)
+  isPrivate                Boolean               @default(false)
+  showActive               Boolean               @default(true)
+  phoneNumber              String?
+  job                      String?
+  isPrivateJob             Boolean               @default(false)
+  degree                   String?
+  isPrivateDegree          Boolean               @default(false)
+  schedule                 Json?
+  hasFreeTime              Boolean               @default(true)
+  updatedAt                DateTime              @updatedAt
+  createdAt                DateTime              @default(now())
+  deletedAt                DateTime?
+  area                     Area                  @relation(fields: [areaId], references: [id])
+  areaId                   Int
+  city                     City                  @relation(fields: [cityId], references: [id])
+  cityId                   Int
+  identifyImage            File                  @relation("identifyImage", fields: [identifyImageId], references: [id])
+  identifyImageId          Int
+  avatar                   File?                 @relation("avatar", fields: [avatarId], references: [id])
+  avatarId                 Int?
+  role                     Role                  @relation(fields: [roleId], references: [id])
+  roleId                   String
+  userImage                UserImage[]
+  userAreaOtherPerson      UserAreaOtherPerson[] // TODO Sửa chỗ này, không cần thiết phải lưu area, có thể lấy ra từ city
+  userCityOtherPerson      UserCityOtherPerson[]
+  userPurposeUseApp        UserPurposeUseApp[]
+  senderMessage            Message[]             @relation("senderMessage")
+  receiverMessage          Message[]             @relation("receiverMessage")
+  socialProvider           SocialProvider[]
+  senderFriend             Friend[]              @relation("senderFriend")
+  receiverFriend           Friend[]              @relation("receiverFriend")
+}
+
+model SocialProvider {
+  @@id([id, type])
+  id          String
+  type        SocialProviderType
+  user        User               @relation(fields: [userId], references: [id])
+  userId      Int                @unique
+  email       String?
+  phoneNumber String?
+  name        String?
+  avatar      String?
+  gender      Gender?
+  birthday    DateTime?
+}
+
+model Friend {
+  @@id([senderId, receiverId])
+  sender     User      @relation("senderFriend", fields: [senderId], references: [id])
+  receiver   User      @relation("receiverFriend", fields: [receiverId], references: [id])
+  senderId   Int
+  receiverId Int
+  sentAt     DateTime  @default(now())
+  acceptedAt DateTime?
+}
+
+model UserImage {
+  @@id([userId, imageId])
+  user    User @relation(fields: [userId], references: [id])
+  image   File @relation(fields: [imageId], references: [id])
+  userId  Int
+  imageId Int
+}
+
+model UserAreaOtherPerson {
+  @@id([userId, areaId])
+  user   User @relation(fields: [userId], references: [id])
+  area   Area @relation(fields: [areaId], references: [id])
+  userId Int
+  areaId Int
+}
+
+model UserCityOtherPerson {
+  @@id([userId, cityId])
+  user   User @relation(fields: [userId], references: [id])
+  city   City @relation(fields: [cityId], references: [id])
+  userId Int
+  cityId Int
+}
+
+model UserPurposeUseApp {
+  @@id([userId, purposeId])
+  user      User          @relation(fields: [userId], references: [id])
+  purpose   PurposeUseApp @relation(fields: [purposeId], references: [id])
+  userId    Int
+  purposeId Int
+}
+
+model Area {
+  id                  Int                   @default(autoincrement()) @id
+  area                String
+  user                User[]
+  city                City[]
+  userAreaOtherPerson UserAreaOtherPerson[]
+}
+
+model City {
+  id                  Int                   @default(autoincrement()) @id
+  city                String
+  area                Area                  @relation(fields: [areaId], references: [id])
+  user                User[]
+  areaId              Int
+  userCityOtherPerson UserCityOtherPerson[]
+}
+
+model PurposeUseApp {
+  id                Int                 @default(autoincrement()) @id
+  value             String
+  userPurposeUseApp UserPurposeUseApp[]
+}
+
+model File {
+  id                Int                 @default(autoincrement()) @id
+  type              FileType
+  url               String
+  thumbnail         String?
+  userIdentifyImage User[]              @relation("identifyImage")
+  userAvatar        User[]              @relation("avatar")
+  userImage         UserImage[]
+  messageAttachment MessageAttachment[]
+}
+
+model Role {
+  id          String   @unique @id
+  name        String
+  description String?
+  permissions String[]
+  user        User[]
+}
+
+model Message {
+  id                Int                 @default(autoincrement()) @id
+  message           String
+  createdAt         DateTime            @default(now())
+  updatedAt         DateTime            @updatedAt
+  messageAttachment MessageAttachment[]
+  sender            User                @relation("senderMessage", fields: [senderId], references: [id])
+  receiver          User                @relation("receiverMessage", fields: [receiverId], references: [id])
+  senderId          Int
+  receiverId        Int
+}
+
+model MessageAttachment {
+  @@id([messageId, fileId])
+  message   Message @relation(fields: [messageId], references: [id])
+  file      File    @relation(fields: [fileId], references: [id])
+  messageId Int
+  fileId    Int
+}
+
+model PostCategory {
+  id    Int    @default(autoincrement()) @id
+  value String
+  Post  Post[]
+}
+
+model Post {
+  id         Int          @default(autoincrement()) @id
+  category   PostCategory @relation(fields: [categoryId], references: [id])
+  categoryId Int
+  comment    Comment[]
+}
+
+model Comment {
+  id            Int       @default(autoincrement()) @id
+  index         Int
+  parentComment Comment?  @relation("ReplyToComment", fields: [parentId], references: [id])
+  reply         Comment[] @relation("ReplyToComment")
+  parentId      Int?
+  content       String
+  post          Post      @relation(fields: [postId], references: [id])
+  postId        Int
+  createdAt     DateTime  @default(now())
+}
+
+model QnA {
+  id       Int    @default(autoincrement()) @id
+  question String
+  answer   String
+}
```


