# Migration `20201003061513-add-recommend-and-dislike`

This migration has been generated by Hieren at 10/3/2020, 6:15:13 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."DislikedUser" (
"userId" text   NOT NULL ,
"dislikedUserId" text   NOT NULL ,
"dislikedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("userId","dislikedUserId")
)

CREATE TABLE "public"."RecommendableUser" (
"sortOrder" integer   NOT NULL ,
"userId" text   NOT NULL ,
"recommendableUserId" text   NOT NULL ,
PRIMARY KEY ("userId","recommendableUserId")
)

CREATE UNIQUE INDEX "RecommendableUser.userId_sortOrder_unique" ON "public"."RecommendableUser"("userId", "sortOrder")

ALTER TABLE "public"."DislikedUser" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."DislikedUser" ADD FOREIGN KEY ("dislikedUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RecommendableUser" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RecommendableUser" ADD FOREIGN KEY ("recommendableUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201003043900-init..20201003061513-add-recommend-and-dislike
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -51,45 +51,49 @@
   gender
 }
 model User {
-  id              String           @default(uuid()) @id
-  password        String?
-  nickName        String
-  introduction    String?
-  birthday        DateTime?
-  gender          Gender?
-  hobbies         String?
-  phoneNumber     String?
-  job             String?
-  height          Int?
-  privateFields   PrivateField[]
-  minAgePrefer    Int?
-  maxAgePrefer    Int?
-  minHeightPrefer Int?
-  maxHeightPrefer Int?
-  genderPrefer    Gender[]
-  distancePrefer  Int?
-  mustHaveFields  MustHaveField[]
-  allowMatching   Boolean          @default(true)
-  isPrivate       Boolean          @default(false)
-  showActive      Boolean          @default(true)
-  avatar          File?            @relation("avatar", fields: [avatarId], references: [id])
-  avatarId        String?
-  role            Role             @relation(fields: [roleId], references: [id])
-  roleId          String
-  userImage       UserImage[]
-  senderMessage   Message[]        @relation("senderMessage")
-  receiverMessage Message[]        @relation("receiverMessage")
-  socialProvider  SocialProvider[]
-  senderFriend    Friend[]         @relation("senderFriend")
-  receiverFriend  Friend[]         @relation("receiverFriend")
-  onlineStatus    OnlineStatus     @default(offline)
-  lastOnline      DateTime?
-  userAnswer      UserAnswer[]
-  updatedAt       DateTime         @updatedAt
-  createdAt       DateTime         @default(now())
-  deletedAt       DateTime?
+  id                String              @default(uuid()) @id
+  password          String?
+  nickName          String
+  introduction      String?
+  birthday          DateTime?
+  gender            Gender?
+  hobbies           String?
+  phoneNumber       String?
+  job               String?
+  height            Int?
+  privateFields     PrivateField[]
+  minAgePrefer      Int?
+  maxAgePrefer      Int?
+  minHeightPrefer   Int?
+  maxHeightPrefer   Int?
+  genderPrefer      Gender[]
+  distancePrefer    Int?
+  mustHaveFields    MustHaveField[]
+  allowMatching     Boolean             @default(true)
+  isPrivate         Boolean             @default(false)
+  showActive        Boolean             @default(true)
+  avatar            File?               @relation("avatar", fields: [avatarId], references: [id])
+  avatarId          String?
+  role              Role                @relation(fields: [roleId], references: [id])
+  roleId            String
+  userImage         UserImage[]
+  senderMessage     Message[]           @relation("senderMessage")
+  receiverMessage   Message[]           @relation("receiverMessage")
+  socialProvider    SocialProvider[]
+  senderFriend      Friend[]            @relation("senderFriend")
+  receiverFriend    Friend[]            @relation("receiverFriend")
+  onlineStatus      OnlineStatus        @default(offline)
+  lastOnline        DateTime?
+  userAnswer        UserAnswer[]
+  dislikedUsers     DislikedUser[]      @relation("dislikedUser")
+  beDislikedByUsers DislikedUser[]      @relation("beDislikedByUser")
+  recommendableUser RecommendableUser[] @relation("recommendableUser")
+  recommendToUser   RecommendableUser[] @relation("recommendToUser")
+  updatedAt         DateTime            @updatedAt
+  createdAt         DateTime            @default(now())
+  deletedAt         DateTime?
 }
 model Question {
   id         String       @default(cuid()) @id
@@ -224,4 +228,23 @@
   name        String
   description String?
   data        Json
 }
+
+model DislikedUser {
+  user           User     @relation("dislikedUser", fields: [userId], references: [id])
+  dislikedUser   User     @relation("beDislikedByUser", fields: [dislikedUserId], references: [id])
+  userId         String
+  dislikedUserId String
+  dislikedAt     DateTime @default(now())
+  @@id([userId, dislikedUserId])
+}
+
+model RecommendableUser {
+  sortOrder           Int
+  user                User   @relation("recommendableUser", fields: [userId], references: [id])
+  recommendableUser   User   @relation("recommendToUser", fields: [recommendableUserId], references: [id])
+  userId              String
+  recommendableUserId String
+  @@id([userId, recommendableUserId])
+  @@unique([userId, sortOrder])
+}
```


